<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bayesian Instrumental Variable analysis for Binary Outcomes • biva</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Bayesian Instrumental Variable analysis for Binary Outcomes">
<meta property="og:description" content="biva">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">biva</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Gaussian.html">Bayesian Instrumental Variable analysis for Continuous Outcomes</a>
    </li>
    <li>
      <a href="../articles/logit.html">Bayesian Instrumental Variable analysis for Binary Outcomes</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Bayesian Instrumental Variable analysis for
Binary Outcomes</h1>
                        <h4 data-toc-skip class="author">Yichi
Zhang</h4>
            
      
      
      <div class="hidden name"><code>logit.Rmd</code></div>

    </div>

    
    
<p>Below we demonstrate the overall workflow of the BIVA approach for
binary outcomes.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">biva</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="demonstration-two-side-noncompliance">Demonstration: two-side noncompliance<a class="anchor" aria-label="anchor" href="#demonstration-two-side-noncompliance"></a>
</h2>
<div class="section level3">
<h3 id="data-simulation">Data simulation<a class="anchor" aria-label="anchor" href="#data-simulation"></a>
</h3>
<p>We simulate some data from a hypothetical randomized experiment with
noncompliance. Those assigned to the treatment group can decide to use
the feature or not. Those assigned to the control group may also use the
feature since it is available to all. In this case, we have two-side
noncompliance where the assigned treated units can opt out and the
assigned control can opt in. The outcome metric is a binary
variable.</p>
<p>Therefore, there are 3 principal strata: compliers, never-takers, and
always-takers.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1997</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span></span>
<span><span class="co"># Covariates: X observed, U unobserved</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="va">U</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## True memberships of principal strata (1:c,2:nt,3:at): S-model depends only on U</span></span>
<span><span class="va">true.PS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n</span><span class="op">)</span></span>
<span><span class="va">U1.ind</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">U</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">U0.ind</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">U</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">num.U1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">U1.ind</span><span class="op">)</span></span>
<span><span class="va">num.U0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">U0.ind</span><span class="op">)</span></span>
<span><span class="va">true.PS</span><span class="op">[</span><span class="va">U1.ind</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Multinom.html" class="external-link">rmultinom</a></span><span class="op">(</span><span class="va">num.U1</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">0.3</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">true.PS</span><span class="op">[</span><span class="va">U0.ind</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Multinom.html" class="external-link">rmultinom</a></span><span class="op">(</span><span class="va">num.U0</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Treatment assigned: half control &amp; half treatment</span></span>
<span><span class="va">Z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Treatment received: determined by principal strata and treatment assigned</span></span>
<span><span class="va">D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n</span><span class="op">)</span></span>
<span><span class="va">c.trt.ind</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">true.PS</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">Z</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">c.ctrl.ind</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">true.PS</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">Z</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">nt.ind</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">true.PS</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">at.ind</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">true.PS</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">num.c.trt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">c.trt.ind</span><span class="op">)</span></span>
<span><span class="va">num.c.ctrl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">c.ctrl.ind</span><span class="op">)</span></span>
<span><span class="va">num.nt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">nt.ind</span><span class="op">)</span></span>
<span><span class="va">num.at</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">at.ind</span><span class="op">)</span></span>
<span><span class="va">D</span><span class="op">[</span><span class="va">at.ind</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">num.at</span><span class="op">)</span></span>
<span><span class="va">D</span><span class="op">[</span><span class="va">c.trt.ind</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">num.c.trt</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Generate observed outcome: Y-model depend on X, U, D, and principal strata</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n</span><span class="op">)</span></span>
<span><span class="va">Y</span><span class="op">[</span><span class="va">c.ctrl.ind</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">num.c.ctrl</span>, <span class="fl">1</span>, <span class="fl">0.3</span> <span class="op">+</span> <span class="fl">0.02</span> <span class="op">*</span> <span class="va">X</span><span class="op">[</span><span class="va">c.ctrl.ind</span><span class="op">]</span> <span class="op">-</span> <span class="fl">0.2</span> <span class="op">*</span> <span class="va">U</span><span class="op">[</span><span class="va">c.ctrl.ind</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">Y</span><span class="op">[</span><span class="va">c.trt.ind</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">num.c.trt</span>, <span class="fl">1</span>, <span class="fl">0.5</span> <span class="op">+</span> <span class="fl">0.02</span> <span class="op">*</span> <span class="va">X</span><span class="op">[</span><span class="va">c.trt.ind</span><span class="op">]</span> <span class="op">-</span> <span class="fl">0.2</span> <span class="op">*</span> <span class="va">U</span><span class="op">[</span><span class="va">c.trt.ind</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">Y</span><span class="op">[</span><span class="va">nt.ind</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">num.c.trt</span>, <span class="fl">1</span>, <span class="fl">0.7</span> <span class="op">+</span> <span class="fl">0.02</span> <span class="op">*</span> <span class="va">X</span><span class="op">[</span><span class="va">nt.ind</span><span class="op">]</span> <span class="op">-</span> <span class="fl">0.2</span> <span class="op">*</span> <span class="va">U</span><span class="op">[</span><span class="va">nt.ind</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in Y[nt.ind] &lt;- rbinom(num.c.trt, 1, 0.7 + 0.02 * X[nt.ind] - 0.2 * :</span></span>
<span><span class="co">#&gt; number of items to replace is not a multiple of replacement length</span></span>
<span><span class="va">Y</span><span class="op">[</span><span class="va">at.ind</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">num.c.trt</span>, <span class="fl">1</span>, <span class="fl">0.4</span> <span class="op">+</span> <span class="fl">0.02</span> <span class="op">*</span> <span class="va">X</span><span class="op">[</span><span class="va">at.ind</span><span class="op">]</span> <span class="op">-</span> <span class="fl">0.2</span> <span class="op">*</span> <span class="va">U</span><span class="op">[</span><span class="va">at.ind</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in Y[at.ind] &lt;- rbinom(num.c.trt, 1, 0.4 + 0.02 * X[at.ind] - 0.2 * :</span></span>
<span><span class="co">#&gt; number of items to replace is not a multiple of replacement length</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">Y</span>, Z <span class="op">=</span> <span class="va">Z</span>, D <span class="op">=</span> <span class="va">D</span>, X <span class="op">=</span> <span class="va">X</span>, U <span class="op">=</span> <span class="va">U</span><span class="op">)</span></span></code></pre></div>
<p>For the strata model, when U = 1, a unit is a complier, a
never-taker, or an always-taker with probability 0.6, 0.3, and 0.1,
respectively. When U = 0, a unit is a complier, a never-taker, or an
always-taker with probability 0.4, 0.5, and 0.1, respectively.</p>
<p>The outcome models are by different strata-nudge combinations. The
compliers may adopt the treatment or not depending on the assigned
nudge, and thus have two outcome models by treatment groups. The
never-takers will never adopt the treatment feature. The always-takers
will always adopt the treatment feature. We assume away the direct
effect of the nudge here so there is only one outcome model for
never-takers, and also one model for always-takers.</p>
<p>The four outcome models depend on both the observed X and the
unobserved U with the same slopes. The contrast between the intercepts
of the outcome models for compliers then becomes the CACE of the
feature, which is 0.5 - 0.3 = 20%.</p>
</div>
<div class="section level3">
<h3 id="ols-analysis">OLS analysis<a class="anchor" aria-label="anchor" href="#ols-analysis"></a>
</h3>
<p>We again fit an OLS model with the adopted treatment D and the
observed covariate X to see the caveats.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">OLS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span>, formula <span class="op">=</span> <span class="va">Y</span> <span class="op">~</span> <span class="va">D</span> <span class="op">+</span> <span class="va">X</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">OLS</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = Y ~ D + X, data = df)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -0.3833 -0.3666 -0.3602  0.6324  0.6513 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;              Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)  0.366418   0.043140   8.494 4.85e-15 ***</span></span>
<span><span class="co">#&gt; D           -0.005740   0.071484  -0.080    0.936    </span></span>
<span><span class="co">#&gt; X           -0.005527   0.034460  -0.160    0.873    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 0.485 on 197 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.0001673,  Adjusted R-squared:  -0.009983 </span></span>
<span><span class="co">#&gt; F-statistic: 0.01648 on 2 and 197 DF,  p-value: 0.9837</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">OLS</span>, <span class="st">"D"</span><span class="op">)</span></span>
<span><span class="co">#&gt;        2.5 %    97.5 %</span></span>
<span><span class="co">#&gt; D -0.1467124 0.1352323</span></span></code></pre></div>
<p>It returns an uninformative insignificant negative estimate of the
treatment effect.</p>
<p>We restart the BIVA workflow to get more insight into the impact.</p>
</div>
<div class="section level3">
<h3 id="prior-predictive-checking">Prior predictive checking<a class="anchor" aria-label="anchor" href="#prior-predictive-checking"></a>
</h3>
<p>The outcome type is specified by having y_type = “binary”. We assume
exclusion restriction, so ER = 1. With two-side noncompliance, we set
side = 2. The parameters in the prior distributions are specified as
well. We first look into what the prior distributions assume about the
parameters.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ivobj</span> <span class="op">&lt;-</span> <span class="va"><a href="https://rdrr.io/pkg/biva/man/biva-package.html" class="external-link">biva</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">df</span>, y <span class="op">=</span> <span class="st">"Y"</span>, d <span class="op">=</span> <span class="st">"D"</span>, z <span class="op">=</span> <span class="st">"Z"</span>,</span>
<span>  x_ymodel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X"</span><span class="op">)</span>,</span>
<span>  x_smodel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X"</span><span class="op">)</span>,</span>
<span>  y_type <span class="op">=</span> <span class="st">"binary"</span>,</span>
<span>  ER <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  side <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  beta_mean_ymodel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  beta_sd_ymodel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  beta_mean_smodel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  beta_sd_smodel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  fit <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SAMPLING FOR MODEL 'logit' NOW (CHAIN 1).</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Gradient evaluation took 5e-06 seconds</span></span>
<span><span class="co">#&gt; Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.05 seconds.</span></span>
<span><span class="co">#&gt; Chain 1: Adjust your expectations accordingly!</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Iteration:    1 / 2000 [  0%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  200 / 2000 [ 10%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  400 / 2000 [ 20%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  600 / 2000 [ 30%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  800 / 2000 [ 40%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1000 / 2000 [ 50%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1001 / 2000 [ 50%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1200 / 2000 [ 60%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1400 / 2000 [ 70%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1600 / 2000 [ 80%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1800 / 2000 [ 90%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 2000 / 2000 [100%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1:  Elapsed Time: 0.081 seconds (Warm-up)</span></span>
<span><span class="co">#&gt; Chain 1:                0.082 seconds (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1:                0.163 seconds (Total)</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SAMPLING FOR MODEL 'logit' NOW (CHAIN 2).</span></span>
<span><span class="co">#&gt; Chain 2: </span></span>
<span><span class="co">#&gt; Chain 2: Gradient evaluation took 3e-06 seconds</span></span>
<span><span class="co">#&gt; Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 0.03 seconds.</span></span>
<span><span class="co">#&gt; Chain 2: Adjust your expectations accordingly!</span></span>
<span><span class="co">#&gt; Chain 2: </span></span>
<span><span class="co">#&gt; Chain 2: </span></span>
<span><span class="co">#&gt; Chain 2: Iteration:    1 / 2000 [  0%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration:  200 / 2000 [ 10%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration:  400 / 2000 [ 20%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration:  600 / 2000 [ 30%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration:  800 / 2000 [ 40%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 1000 / 2000 [ 50%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 1001 / 2000 [ 50%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 1200 / 2000 [ 60%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 1400 / 2000 [ 70%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 1600 / 2000 [ 80%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 1800 / 2000 [ 90%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 2000 / 2000 [100%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2: </span></span>
<span><span class="co">#&gt; Chain 2:  Elapsed Time: 0.08 seconds (Warm-up)</span></span>
<span><span class="co">#&gt; Chain 2:                0.082 seconds (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2:                0.162 seconds (Total)</span></span>
<span><span class="co">#&gt; Chain 2: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SAMPLING FOR MODEL 'logit' NOW (CHAIN 3).</span></span>
<span><span class="co">#&gt; Chain 3: </span></span>
<span><span class="co">#&gt; Chain 3: Gradient evaluation took 3e-06 seconds</span></span>
<span><span class="co">#&gt; Chain 3: 1000 transitions using 10 leapfrog steps per transition would take 0.03 seconds.</span></span>
<span><span class="co">#&gt; Chain 3: Adjust your expectations accordingly!</span></span>
<span><span class="co">#&gt; Chain 3: </span></span>
<span><span class="co">#&gt; Chain 3: </span></span>
<span><span class="co">#&gt; Chain 3: Iteration:    1 / 2000 [  0%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration:  200 / 2000 [ 10%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration:  400 / 2000 [ 20%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration:  600 / 2000 [ 30%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration:  800 / 2000 [ 40%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration: 1000 / 2000 [ 50%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration: 1001 / 2000 [ 50%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration: 1200 / 2000 [ 60%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration: 1400 / 2000 [ 70%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration: 1600 / 2000 [ 80%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration: 1800 / 2000 [ 90%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration: 2000 / 2000 [100%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 3: </span></span>
<span><span class="co">#&gt; Chain 3:  Elapsed Time: 0.081 seconds (Warm-up)</span></span>
<span><span class="co">#&gt; Chain 3:                0.082 seconds (Sampling)</span></span>
<span><span class="co">#&gt; Chain 3:                0.163 seconds (Total)</span></span>
<span><span class="co">#&gt; Chain 3: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SAMPLING FOR MODEL 'logit' NOW (CHAIN 4).</span></span>
<span><span class="co">#&gt; Chain 4: </span></span>
<span><span class="co">#&gt; Chain 4: Gradient evaluation took 3e-06 seconds</span></span>
<span><span class="co">#&gt; Chain 4: 1000 transitions using 10 leapfrog steps per transition would take 0.03 seconds.</span></span>
<span><span class="co">#&gt; Chain 4: Adjust your expectations accordingly!</span></span>
<span><span class="co">#&gt; Chain 4: </span></span>
<span><span class="co">#&gt; Chain 4: </span></span>
<span><span class="co">#&gt; Chain 4: Iteration:    1 / 2000 [  0%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration:  200 / 2000 [ 10%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration:  400 / 2000 [ 20%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration:  600 / 2000 [ 30%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration:  800 / 2000 [ 40%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration: 1000 / 2000 [ 50%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration: 1001 / 2000 [ 50%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration: 1200 / 2000 [ 60%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration: 1400 / 2000 [ 70%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration: 1600 / 2000 [ 80%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration: 1800 / 2000 [ 90%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration: 2000 / 2000 [100%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 4: </span></span>
<span><span class="co">#&gt; Chain 4:  Elapsed Time: 0.08 seconds (Warm-up)</span></span>
<span><span class="co">#&gt; Chain 4:                0.08 seconds (Sampling)</span></span>
<span><span class="co">#&gt; Chain 4:                0.16 seconds (Total)</span></span>
<span><span class="co">#&gt; Chain 4:</span></span>
<span></span>
<span><span class="va">ivobj</span><span class="op">$</span><span class="fu">plotPrior</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="logit_files/figure-html/priors_check_two_side-1.png" width="700" style="display: block; margin: auto;"></p>
<p>By prior, the effect of the AI-powered dubbing feature among
compliers is negligible. The proportions of compliers, never-takers, and
always-takers are similar.</p>
</div>
<div class="section level3">
<h3 id="fitting-a-biva-model-to-the-data">Fitting a BIVA model to the data<a class="anchor" aria-label="anchor" href="#fitting-a-biva-model-to-the-data"></a>
</h3>
<p>Now we fit a BIVA model to the data.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ivobj</span> <span class="op">&lt;-</span> <span class="va"><a href="https://rdrr.io/pkg/biva/man/biva-package.html" class="external-link">biva</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">df</span>, y <span class="op">=</span> <span class="st">"Y"</span>, d <span class="op">=</span> <span class="st">"D"</span>, z <span class="op">=</span> <span class="st">"Z"</span>,</span>
<span>  x_ymodel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X"</span><span class="op">)</span>,</span>
<span>  x_smodel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X"</span><span class="op">)</span>,</span>
<span>  y_type <span class="op">=</span> <span class="st">"binary"</span>,</span>
<span>  ER <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  side <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  beta_mean_ymodel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  beta_sd_ymodel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  beta_mean_smodel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  beta_sd_smodel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  fit <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SAMPLING FOR MODEL 'logit' NOW (CHAIN 1).</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Gradient evaluation took 5e-06 seconds</span></span>
<span><span class="co">#&gt; Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.05 seconds.</span></span>
<span><span class="co">#&gt; Chain 1: Adjust your expectations accordingly!</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Iteration:    1 / 2000 [  0%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  200 / 2000 [ 10%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  400 / 2000 [ 20%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  600 / 2000 [ 30%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  800 / 2000 [ 40%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1000 / 2000 [ 50%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1001 / 2000 [ 50%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1200 / 2000 [ 60%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1400 / 2000 [ 70%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1600 / 2000 [ 80%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1800 / 2000 [ 90%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 2000 / 2000 [100%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1:  Elapsed Time: 0.083 seconds (Warm-up)</span></span>
<span><span class="co">#&gt; Chain 1:                0.085 seconds (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1:                0.168 seconds (Total)</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SAMPLING FOR MODEL 'logit' NOW (CHAIN 2).</span></span>
<span><span class="co">#&gt; Chain 2: </span></span>
<span><span class="co">#&gt; Chain 2: Gradient evaluation took 3e-06 seconds</span></span>
<span><span class="co">#&gt; Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 0.03 seconds.</span></span>
<span><span class="co">#&gt; Chain 2: Adjust your expectations accordingly!</span></span>
<span><span class="co">#&gt; Chain 2: </span></span>
<span><span class="co">#&gt; Chain 2: </span></span>
<span><span class="co">#&gt; Chain 2: Iteration:    1 / 2000 [  0%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration:  200 / 2000 [ 10%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration:  400 / 2000 [ 20%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration:  600 / 2000 [ 30%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration:  800 / 2000 [ 40%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 1000 / 2000 [ 50%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 1001 / 2000 [ 50%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 1200 / 2000 [ 60%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 1400 / 2000 [ 70%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 1600 / 2000 [ 80%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 1800 / 2000 [ 90%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 2000 / 2000 [100%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2: </span></span>
<span><span class="co">#&gt; Chain 2:  Elapsed Time: 0.084 seconds (Warm-up)</span></span>
<span><span class="co">#&gt; Chain 2:                0.083 seconds (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2:                0.167 seconds (Total)</span></span>
<span><span class="co">#&gt; Chain 2: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SAMPLING FOR MODEL 'logit' NOW (CHAIN 3).</span></span>
<span><span class="co">#&gt; Chain 3: </span></span>
<span><span class="co">#&gt; Chain 3: Gradient evaluation took 3e-06 seconds</span></span>
<span><span class="co">#&gt; Chain 3: 1000 transitions using 10 leapfrog steps per transition would take 0.03 seconds.</span></span>
<span><span class="co">#&gt; Chain 3: Adjust your expectations accordingly!</span></span>
<span><span class="co">#&gt; Chain 3: </span></span>
<span><span class="co">#&gt; Chain 3: </span></span>
<span><span class="co">#&gt; Chain 3: Iteration:    1 / 2000 [  0%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration:  200 / 2000 [ 10%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration:  400 / 2000 [ 20%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration:  600 / 2000 [ 30%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration:  800 / 2000 [ 40%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration: 1000 / 2000 [ 50%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration: 1001 / 2000 [ 50%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration: 1200 / 2000 [ 60%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration: 1400 / 2000 [ 70%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration: 1600 / 2000 [ 80%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration: 1800 / 2000 [ 90%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration: 2000 / 2000 [100%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 3: </span></span>
<span><span class="co">#&gt; Chain 3:  Elapsed Time: 0.081 seconds (Warm-up)</span></span>
<span><span class="co">#&gt; Chain 3:                0.084 seconds (Sampling)</span></span>
<span><span class="co">#&gt; Chain 3:                0.165 seconds (Total)</span></span>
<span><span class="co">#&gt; Chain 3: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SAMPLING FOR MODEL 'logit' NOW (CHAIN 4).</span></span>
<span><span class="co">#&gt; Chain 4: </span></span>
<span><span class="co">#&gt; Chain 4: Gradient evaluation took 3e-06 seconds</span></span>
<span><span class="co">#&gt; Chain 4: 1000 transitions using 10 leapfrog steps per transition would take 0.03 seconds.</span></span>
<span><span class="co">#&gt; Chain 4: Adjust your expectations accordingly!</span></span>
<span><span class="co">#&gt; Chain 4: </span></span>
<span><span class="co">#&gt; Chain 4: </span></span>
<span><span class="co">#&gt; Chain 4: Iteration:    1 / 2000 [  0%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration:  200 / 2000 [ 10%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration:  400 / 2000 [ 20%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration:  600 / 2000 [ 30%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration:  800 / 2000 [ 40%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration: 1000 / 2000 [ 50%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration: 1001 / 2000 [ 50%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration: 1200 / 2000 [ 60%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration: 1400 / 2000 [ 70%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration: 1600 / 2000 [ 80%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration: 1800 / 2000 [ 90%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration: 2000 / 2000 [100%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 4: </span></span>
<span><span class="co">#&gt; Chain 4:  Elapsed Time: 0.082 seconds (Warm-up)</span></span>
<span><span class="co">#&gt; Chain 4:                0.082 seconds (Sampling)</span></span>
<span><span class="co">#&gt; Chain 4:                0.164 seconds (Total)</span></span>
<span><span class="co">#&gt; Chain 4:</span></span>
<span><span class="co">#&gt; Fitting model to the data</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SAMPLING FOR MODEL 'logit' NOW (CHAIN 1).</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Gradient evaluation took 0.000207 seconds</span></span>
<span><span class="co">#&gt; Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 2.07 seconds.</span></span>
<span><span class="co">#&gt; Chain 1: Adjust your expectations accordingly!</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Iteration:    1 / 2000 [  0%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  200 / 2000 [ 10%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  400 / 2000 [ 20%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  600 / 2000 [ 30%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  800 / 2000 [ 40%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1000 / 2000 [ 50%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1001 / 2000 [ 50%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1200 / 2000 [ 60%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1400 / 2000 [ 70%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1600 / 2000 [ 80%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1800 / 2000 [ 90%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 2000 / 2000 [100%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1:  Elapsed Time: 2.065 seconds (Warm-up)</span></span>
<span><span class="co">#&gt; Chain 1:                1.718 seconds (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1:                3.783 seconds (Total)</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SAMPLING FOR MODEL 'logit' NOW (CHAIN 2).</span></span>
<span><span class="co">#&gt; Chain 2: </span></span>
<span><span class="co">#&gt; Chain 2: Gradient evaluation took 0.00019 seconds</span></span>
<span><span class="co">#&gt; Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 1.9 seconds.</span></span>
<span><span class="co">#&gt; Chain 2: Adjust your expectations accordingly!</span></span>
<span><span class="co">#&gt; Chain 2: </span></span>
<span><span class="co">#&gt; Chain 2: </span></span>
<span><span class="co">#&gt; Chain 2: Iteration:    1 / 2000 [  0%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration:  200 / 2000 [ 10%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration:  400 / 2000 [ 20%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration:  600 / 2000 [ 30%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration:  800 / 2000 [ 40%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 1000 / 2000 [ 50%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 1001 / 2000 [ 50%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 1200 / 2000 [ 60%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 1400 / 2000 [ 70%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 1600 / 2000 [ 80%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 1800 / 2000 [ 90%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 2000 / 2000 [100%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2: </span></span>
<span><span class="co">#&gt; Chain 2:  Elapsed Time: 1.955 seconds (Warm-up)</span></span>
<span><span class="co">#&gt; Chain 2:                1.741 seconds (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2:                3.696 seconds (Total)</span></span>
<span><span class="co">#&gt; Chain 2: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SAMPLING FOR MODEL 'logit' NOW (CHAIN 3).</span></span>
<span><span class="co">#&gt; Chain 3: </span></span>
<span><span class="co">#&gt; Chain 3: Gradient evaluation took 0.00019 seconds</span></span>
<span><span class="co">#&gt; Chain 3: 1000 transitions using 10 leapfrog steps per transition would take 1.9 seconds.</span></span>
<span><span class="co">#&gt; Chain 3: Adjust your expectations accordingly!</span></span>
<span><span class="co">#&gt; Chain 3: </span></span>
<span><span class="co">#&gt; Chain 3: </span></span>
<span><span class="co">#&gt; Chain 3: Iteration:    1 / 2000 [  0%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration:  200 / 2000 [ 10%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration:  400 / 2000 [ 20%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration:  600 / 2000 [ 30%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration:  800 / 2000 [ 40%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration: 1000 / 2000 [ 50%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration: 1001 / 2000 [ 50%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration: 1200 / 2000 [ 60%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration: 1400 / 2000 [ 70%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration: 1600 / 2000 [ 80%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration: 1800 / 2000 [ 90%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 3: Iteration: 2000 / 2000 [100%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 3: </span></span>
<span><span class="co">#&gt; Chain 3:  Elapsed Time: 1.94 seconds (Warm-up)</span></span>
<span><span class="co">#&gt; Chain 3:                1.747 seconds (Sampling)</span></span>
<span><span class="co">#&gt; Chain 3:                3.687 seconds (Total)</span></span>
<span><span class="co">#&gt; Chain 3: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SAMPLING FOR MODEL 'logit' NOW (CHAIN 4).</span></span>
<span><span class="co">#&gt; Chain 4: </span></span>
<span><span class="co">#&gt; Chain 4: Gradient evaluation took 0.000196 seconds</span></span>
<span><span class="co">#&gt; Chain 4: 1000 transitions using 10 leapfrog steps per transition would take 1.96 seconds.</span></span>
<span><span class="co">#&gt; Chain 4: Adjust your expectations accordingly!</span></span>
<span><span class="co">#&gt; Chain 4: </span></span>
<span><span class="co">#&gt; Chain 4: </span></span>
<span><span class="co">#&gt; Chain 4: Iteration:    1 / 2000 [  0%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration:  200 / 2000 [ 10%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration:  400 / 2000 [ 20%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration:  600 / 2000 [ 30%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration:  800 / 2000 [ 40%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration: 1000 / 2000 [ 50%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration: 1001 / 2000 [ 50%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration: 1200 / 2000 [ 60%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration: 1400 / 2000 [ 70%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration: 1600 / 2000 [ 80%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration: 1800 / 2000 [ 90%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 4: Iteration: 2000 / 2000 [100%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 4: </span></span>
<span><span class="co">#&gt; Chain 4:  Elapsed Time: 1.898 seconds (Warm-up)</span></span>
<span><span class="co">#&gt; Chain 4:                1.67 seconds (Sampling)</span></span>
<span><span class="co">#&gt; Chain 4:                3.568 seconds (Total)</span></span>
<span><span class="co">#&gt; Chain 4:</span></span>
<span><span class="co">#&gt; Found more than one class "Rcpp_rstantools_model_logit" in cache; using the first, from namespace 'biva'</span></span>
<span><span class="co">#&gt; Also defined by 'im'</span></span>
<span><span class="co">#&gt; Found more than one class "Rcpp_rstantools_model_logit" in cache; using the first, from namespace 'biva'</span></span>
<span><span class="co">#&gt; Also defined by 'im'</span></span>
<span><span class="co">#&gt; All diagnostics look fine</span></span></code></pre></div>
<p>We look at the trace plot of outcomes in each strata. The four plots
are the posterior draws of the mean outcomes among the compliers
assinged to control, the compliers nudged to treatment, the
never-takers, and the always-takers.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ivobj</span><span class="op">$</span><span class="fu">tracePlot</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="logit_files/figure-html/tracePlot_two_side-1.png" width="700" style="display: block; margin: auto;"></p>
<p>The convergence and mixing look good.</p>
<p>We run the weak instrument test.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ivobj</span><span class="op">$</span><span class="fu">weakIVTest</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; The instrument is not considered weak, resulting in an estimated 54% of compliers in the population.</span></span></code></pre></div>
<p>No weak instrument issue is detected.</p>
<p>We can use the following methods to summarize our findings:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Posterior distribution of the strata probability</span></span>
<span><span class="va">ivobj</span><span class="op">$</span><span class="fu">strataProbEstimate</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Given the data, we estimate that there is a 54% probability that the unit is a complier, a 36% probability that the unit is a never-taker, and a 9% probability that the unit is an always-taker.</span></span>
<span><span class="co"># Posterior probability that CACE is greater than 0.1</span></span>
<span><span class="va">ivobj</span><span class="op">$</span><span class="fu">calcProb</span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Given the data, we estimate that the probability that the effect is more than 0.1 is 61%.</span></span>
<span><span class="co"># Posterior median of the CACE</span></span>
<span><span class="va">ivobj</span><span class="op">$</span><span class="fu">pointEstimate</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.1315855</span></span>
<span><span class="co"># Posterior mean of the CACE</span></span>
<span><span class="va">ivobj</span><span class="op">$</span><span class="fu">pointEstimate</span><span class="op">(</span>median <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.1295604</span></span>
<span><span class="co"># 75% credible interval of the CACE</span></span>
<span><span class="va">ivobj</span><span class="op">$</span><span class="fu">credibleInterval</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Given the data, we estimate that there is a 75% probability that the CACE is between 0 and 0.26.</span></span>
<span><span class="co"># 95% credible interval of the CACE</span></span>
<span><span class="va">ivobj</span><span class="op">$</span><span class="fu">credibleInterval</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="co">#&gt; Given the data, we estimate that there is a 95% probability that the CACE is between -0.08 and 0.34.</span></span></code></pre></div>
<p>The posterior returns informative conclusions on the impact of the
treatment.</p>
<p>Visualizations of how the data updates our knowledge about the impact
by comparing its posterior distribution with the prior can be done by
running the following methods. We hide them here.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ivobj</span><span class="op">$</span><span class="fu">vizdraws</span><span class="op">(</span></span>
<span>  display_mode_name <span class="op">=</span> <span class="cn">TRUE</span>, breaks <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  break_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"&lt; 0.1"</span>, <span class="st">"&gt; 0.1"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">ivobj</span><span class="op">$</span><span class="fu">lollipop</span><span class="op">(</span>threshold <span class="op">=</span> <span class="fl">0.1</span>, mediumText <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span></code></pre></div>
<hr>
<div class="section level4">
<h4 id="biva">BIVA<a class="anchor" aria-label="anchor" href="#biva"></a>
</h4>
<p>Licensed under the Apache License, Version 2.0.<br></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Yichi Zhang.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
